<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phân Tích Dãy Số - Daniel</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      body {
        background-color: #f0f2f5;
        font-family: "Segoe UI", Arial, sans-serif;
        min-height: 100vh;
      }
      .navbar {
        background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 15px 0;
      }
      .navbar-brand {
        font-size: 1.5rem;
        font-weight: 600;
      }
      .main-container {
        max-width: 1000px;
        margin: 30px auto;
        padding: 0 20px;
      }
      .card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        background: white;
        margin-bottom: 30px;
        overflow: hidden;
      }
      .card-header {
        background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%);
        color: white;
        padding: 25px;
        text-align: center;
        border-bottom: none;
      }
      .card-header h2 {
        font-size: 2rem;
        font-weight: 600;
        margin: 0;
      }
      .card-body {
        padding: 40px;
      }
      .mode-selector {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .mode-selector h5 {
        color: #1a237e;
        font-weight: 600;
        margin-bottom: 15px;
      }
      .form-check {
        margin-bottom: 10px;
      }
      .form-check-input {
        width: 1.2em;
        height: 1.2em;
        margin-top: 0.2em;
      }
      .form-check-input:checked {
        background-color: #1976d2;
        border-color: #1976d2;
      }
      .form-check-label {
        font-size: 1.1rem;
        color: #2c3e50;
        padding-left: 8px;
      }
      .sequence-input {
        margin-bottom: 30px;
      }
      .form-label {
        font-weight: 500;
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }
      .form-control {
        padding: 12px;
        border-radius: 10px;
        border: 2px solid #e0e0e0;
        font-size: 1rem;
        transition: all 0.3s ease;
      }
      .form-control:focus {
        border-color: #1976d2;
        box-shadow: 0 0 0 0.2rem rgba(25, 118, 210, 0.15);
      }
      .btn {
        padding: 12px 25px;
        font-size: 1rem;
        font-weight: 500;
        border-radius: 10px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
      }
      .btn-primary {
        background: linear-gradient(135deg, #0d47a1 0%, #1976d2 100%);
        border: none;
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, #1976d2 0%, #2196f3 100%);
        transform: translateY(-2px);
      }
      .result-section {
        background: #ffffff;
        border-radius: 15px;
        padding: 25px;
        margin-top: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #e0e0e0;
      }
      .result-section h4 {
        color: #1a237e;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e3f2fd;
      }
      .result-section p {
        color: #2c3e50;
        font-size: 1.1rem;
        margin-bottom: 15px;
      }
      .result-section strong {
        color: #1976d2;
      }
      .alert {
        border: none;
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
        font-size: 1.1rem;
      }
      .alert-success {
        background: #e8f5e9;
        color: #2e7d32;
      }
      .alert-danger {
        background: #fbe9e7;
        color: #d32f2f;
      }
      .alert-warning {
        background: #fff3e0;
        color: #f57c00;
      }
      @media (max-width: 768px) {
        .card-body {
          padding: 20px;
        }
        .mode-selector {
          padding: 20px;
        }
        .form-check-label {
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="/">Daniel</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle active"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="fas fa-tools"></i> Tools
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item active" href="/number-analysis">
                    <i class="fas fa-calculator"></i> Phân Tích Dãy Số</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="/data-analysis">
                    <i class="fas fa-table"></i> Phân Tích Dữ Liệu</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="/pdf-analysis">
                    <i class="fas fa-file-pdf"></i> Phân Tích PDF</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="main-container">
      <div class="card">
        <div class="card-header">
          <h2>Phân Tích Dãy Số</h2>
        </div>
        <div class="card-body">
          <div class="mode-selector">
            <h5>Chọn chế độ phân tích:</h5>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="mode"
                id="singleMode"
                value="single"
                checked
                onchange="switchMode()"
              />
              <label class="form-check-label" for="singleMode">
                <i class="fas fa-list-ol"></i> Tính tổng số lượng (1 dãy số)
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="mode"
                id="dualMode"
                value="dual"
                onchange="switchMode()"
              />
              <label class="form-check-label" for="dualMode">
                <i class="fas fa-link"></i> Kiểm tra tính liên tục (2 dãy số)
              </label>
            </div>
          </div>

          <div id="singleSequence" class="sequence-input">
            <div class="mb-3">
              <label for="numbers" class="form-label">
                <i class="fas fa-keyboard"></i> Nhập dãy số:
              </label>
              <input
                type="text"
                class="form-control"
                id="numbers"
                placeholder="Ví dụ: 1-10, 12, 15, 19-23"
                onkeypress="handleKeyPress(event)"
                onkeydown="handleKeyDown(event)"
              />
            </div>
          </div>

          <div id="dualSequence" class="sequence-input">
            <div class="mb-3">
              <label for="sequence1" class="form-label">
                <i class="fas fa-list-ol"></i> Dãy số thứ nhất:
              </label>
              <input
                type="text"
                class="form-control"
                id="sequence1"
                placeholder="Ví dụ: 6,11-18,20"
                onkeypress="handleKeyPress(event)"
                onkeydown="handleKeyDown(event)"
              />
            </div>
            <div class="mb-3">
              <label for="sequence2" class="form-label">
                <i class="fas fa-list-ol"></i> Dãy số thứ hai:
              </label>
              <input
                type="text"
                class="form-control"
                id="sequence2"
                placeholder="Ví dụ: 1-5,7-10,19,21"
                onkeypress="handleKeyPress(event)"
                onkeydown="handleKeyDown(event)"
              />
            </div>
          </div>

          <div class="text-center">
            <button class="btn btn-primary" onclick="calculate()">
              <i class="fas fa-calculator"></i> Phân tích
            </button>
          </div>

          <div id="result" class="alert">
            <div id="singleResult" class="result-section">
              <h4>Thống kê số lượng</h4>
              <p>
                Tổng số lượng số: <strong><span id="count">0</span></strong>
              </p>
              <p>Danh sách số: <span id="numberList"></span></p>
            </div>

            <div id="continuityResult" class="result-section">
              <h4>Phân tích tính liên tục</h4>
              <p id="continuityMessage" class="mb-0"></p>
              <div
                id="duplicateWarning"
                class="alert alert-warning mt-3"
                style="display: none"
              >
                <i class="fas fa-exclamation-triangle"></i>
                <span id="duplicateMessage"></span>
              </div>
            </div>
          </div>

          <div id="error" class="alert alert-danger"></div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Khởi tạo giao diện
        switchMode();

        // Thêm xử lý phím tắt cho toàn bộ trang
        document.addEventListener("keydown", function (event) {
          // Kiểm tra nếu đang focus vào input
          const activeElement = document.activeElement;
          const isInputFocused = activeElement.tagName === "INPUT";

          // Xử lý phím Enter
          if (event.key === "Enter" && isInputFocused) {
            calculate();
          }

          // Xử lý phím Escape
          if (event.key === "Escape") {
            // Reset tất cả input và kết quả
            document.getElementById("numbers").value = "";
            document.getElementById("sequence1").value = "";
            document.getElementById("sequence2").value = "";
            document.getElementById("result").style.display = "none";
            document.getElementById("error").style.display = "none";

            // Focus vào input phù hợp dựa theo mode
            const mode = document.querySelector(
              'input[name="mode"]:checked'
            ).value;
            if (mode === "single") {
              document.getElementById("numbers").focus();
            } else {
              document.getElementById("sequence1").focus();
            }

            // Nếu đang focus vào input, blur input đó
            if (isInputFocused) {
              activeElement.blur();
            }
          }
        });

        // Thêm tooltip cho các nút
        const calculateBtn = document.querySelector(".btn-primary");
        if (calculateBtn) {
          calculateBtn.title = "Nhấn Enter để thực thi";
        }
      });

      function handleKeyDown(event) {
        // Kiểm tra nếu phím nhấn là Delete
        if (event.key === "Delete") {
          // Xóa nội dung của input hiện tại
          event.target.value = "";

          // Ẩn kết quả và thông báo lỗi
          document.getElementById("result").style.display = "none";
          document.getElementById("error").style.display = "none";

          // Focus vào input để người dùng có thể nhập tiếp
          event.target.focus();
        }
      }

      function handleKeyPress(event) {
        // Kiểm tra nếu phím nhấn là Enter
        if (event.key === "Enter") {
          calculate();
        }
      }

      function switchMode() {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        document.getElementById("singleSequence").style.display =
          mode === "single" ? "block" : "none";
        document.getElementById("dualSequence").style.display =
          mode === "dual" ? "block" : "none";
        document.getElementById("singleResult").style.display =
          mode === "single" ? "block" : "none";
        document.getElementById("continuityResult").style.display =
          mode === "dual" ? "block" : "none";

        // Reset form
        document.getElementById("result").style.display = "none";
        document.getElementById("error").style.display = "none";
        document.getElementById("numbers").value = "";
        document.getElementById("sequence1").value = "";
        document.getElementById("sequence2").value = "";
      }

      function calculate() {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const resultDiv = document.getElementById("result");
        const errorDiv = document.getElementById("error");

        // Ẩn các thông báo trước
        resultDiv.style.display = "none";
        errorDiv.style.display = "none";

        let data;
        if (mode === "single") {
          const numbers = document.getElementById("numbers").value;
          data = `mode=single&numbers=${encodeURIComponent(numbers)}`;
        } else {
          const sequence1 = document.getElementById("sequence1").value;
          const sequence2 = document.getElementById("sequence2").value;
          data = `mode=dual&sequence1=${encodeURIComponent(
            sequence1
          )}&sequence2=${encodeURIComponent(sequence2)}`;
        }

        fetch("/calculate", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: data,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
              errorDiv.textContent = data.error;
              errorDiv.style.display = "block";
            } else {
              if (mode === "single") {
                document.getElementById("count").textContent = data.count;
                document.getElementById("numberList").textContent =
                  data.numbers.join(", ");
                resultDiv.className = "alert alert-success";
              } else {
                const continuityMessage =
                  document.getElementById("continuityMessage");
                const duplicateWarning =
                  document.getElementById("duplicateWarning");
                const duplicateMessage =
                  document.getElementById("duplicateMessage");

                // Kiểm tra nếu thông báo chứa thông tin về số trùng
                if (data.continuity_message.includes("Phát hiện số trùng")) {
                  duplicateMessage.textContent = data.continuity_message;
                  duplicateWarning.style.display = "block";
                  continuityMessage.style.display = "none";
                  resultDiv.className = "alert alert-danger";
                } else {
                  duplicateWarning.style.display = "none";
                  continuityMessage.style.display = "block";
                  continuityMessage.textContent = data.continuity_message;
                  if (data.continuity_message.includes("Không liên tục")) {
                    resultDiv.className = "alert alert-danger";
                  } else if (data.continuity_message.includes("Liên tục")) {
                    resultDiv.className = "alert alert-success";
                  } else {
                    resultDiv.className = "alert alert-warning";
                  }
                }
                resultDiv.style.display = "block";
              }
            }
          })
          .catch((error) => {
            errorDiv.textContent =
              "Có lỗi xảy ra khi tính toán. Vui lòng thử lại.";
            errorDiv.style.display = "block";
          });
      }
    </script>
  </body>
</html>
